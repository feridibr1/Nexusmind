name: ios-unsigned
on:
  workflow_dispatch:
jobs:
  build:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install XcodeGen
        run: brew install xcodegen
      - name: Generate Xcode project
        run: cd ios && xcodegen generate
      - name: Build app (no code signing)
        run: |
          xcodebuild -project ios/NexusMind.xcodeproj \
            -scheme NexusMind \
            -configuration Release \
            -sdk iphoneos \
            CODE_SIGNING_ALLOWED=NO \
            CODE_SIGNING_REQUIRED=NO \
            CODE_SIGNING_IDENTITY="" \
            DEVELOPMENT_TEAM="" \
            PRODUCT_BUNDLE_IDENTIFIER=net.nexusmind.app \
            -derivedDataPath build/DerivedData
      - name: Package IPA
        run: |
          APP_PATH="build/DerivedData/Build/Products/Release-iphoneos/NexusMind.app"
          mkdir -p Payload
          cp -R "$APP_PATH" Payload/
          cd Payload
          zip -r ../NexusMind.ipa .
      - name: Upload IPA
        uses: actions/upload-artifact@v4
        with:
          name: ipa
          path: NexusMind.ipa
